<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/ProductFactory.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> ProductFactory.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">88.46% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>23/26</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">66.67% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>4/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">84.62% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>11/13</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">85.29% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>29/34</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//SPDX-License-Identifier: MIT
&nbsp;
pragma solidity ^0.8.0;
&nbsp;
import "./Product.sol";
&nbsp;
error ProductFactory__NotSeller();
error ProductFactory__ProductNotValid();
&nbsp;
/**
 *@title ProductFactory
 *@author Nikhil
 *@notice contract is not properly test, just basic testing has been done
 */
contract ProductFactory {
    /* Events */
    /**
     *@dev This event emitted when a new product is added to products list. useful to keep track the products
     offchain
    */
    event ProductAdded(
        address indexed productAddress,
        uint256 indexed time,
        uint256 indexed warrantyPeriod
    );
    /**
     *@dev This event emitted when an existing product is deleted from the products list
     */
    event ProductDeleted(address indexed productAddress, uint256 indexed time);
&nbsp;
    /* ProductFactory State variables */
    Product[] private products;
    address private FactoryOwner;
    uint256 private s_productIndex;
    mapping(address =&gt; uint256) private s_addressToProductIndex;
    mapping(address =&gt; bool) private s_isProductAvailable;
&nbsp;
    /**
     *@dev Modifers are implemented in this section, Revert if the caller address is not same as
     address of the product adder
     */
    modifier haveDeleteAccess(address caller, address productAddress) {
        if (products[s_addressToProductIndex[productAddress]].getSeller() != caller) {
            revert ProductFactory__NotSeller();
        }
        _;
    }
&nbsp;
    modifier isProductAvailable(address productAddress) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (s_isProductAvailable[productAddress] == false) {
            revert ProductFactory__ProductNotValid();
        }
        _;
    }
&nbsp;
    /**
     *@dev The actual function for interacting with ProductFactory Contract
     */
    constructor() {
        FactoryOwner = msg.sender;
        s_productIndex = 0;
    }
&nbsp;
    /**
     *@dev Create a product and add it to the list "products",
     *@param name_ name of the prouduct.
     *@param symbol_ not necessarily needed(just provided in case, if not made something default explicity)
     *@param warrantyPeriod_ the timeInterval for the warranty to be available on the product
     *@param ProductURI the takenURI of the metadata file of a product(metadata generated, when a seller add products of its details)
     */
    function addProduct(
        string memory name_,
        string memory symbol_,
        uint256 warrantyPeriod_,
        string memory ProductURI
    ) external {
        Product product = new Product(
            address(msg.sender),
            name_,
            symbol_,
            warrantyPeriod_,
            ProductURI
        );
        products.push(product);
        s_addressToProductIndex[address(product)] = s_productIndex;
        s_isProductAvailable[address(product)] = true;
        emit ProductAdded(address(product), block.timestamp, warrantyPeriod_);
        s_productIndex++;
    }
&nbsp;
    /**
     *@notice Some basic getter functions, Name implies the functionality
     *@dev These functions facilitates the process of fetching data from contract to front end
     */
    function getNumberOfProducts() public view returns (uint256) {
        return s_productIndex;
    }
&nbsp;
    function getFactoryOwner() public view returns (address) {
        return FactoryOwner;
    }
&nbsp;
    function getProductName(address productAddress)
        public
        view
        isProductAvailable(productAddress)
        returns (string memory)
    {
        return products[s_addressToProductIndex[productAddress]].name();
    }
&nbsp;
    function getProductSymbol(address productAddress)
        public
        view
        isProductAvailable(productAddress)
        returns (string memory)
    {
        return products[s_addressToProductIndex[productAddress]].symbol();
    }
&nbsp;
    function getWarrantyPeriod(address productAddress)
        public
        view
        isProductAvailable(productAddress)
        returns (uint256)
    {
        return products[s_addressToProductIndex[productAddress]].getWarrantyPeriod();
    }
&nbsp;
    /**
     *@dev Create a product and add it to the list "products",
     *@param productAddress name of the prouduct.
     *@param tokenID not necessarily needed(just provided in case, if not made something default explicity)
     */
<span class="fstat-no" title="function not covered" >    function getProductURI(address productAddress, uint256 tokenID)</span>
        public
        view
        isProductAvailable(productAddress)
        returns (string memory)
    {
<span class="cstat-no" title="statement not covered" >        uint256 index = s_addressToProductIndex[productAddress];</span>
<span class="cstat-no" title="statement not covered" >        return products[index].tokenURI(tokenID);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getProductAtAddress(address productAddress)</span>
        public
        view
        isProductAvailable(productAddress)
        returns (Product)
    {
<span class="cstat-no" title="statement not covered" >        return products[s_addressToProductIndex[productAddress]];</span>
    }
&nbsp;
    /**
     *@dev This method is not particularly useful in the contract usefulnees.
     Only implemented for the testing purposes
     @param productIndex index of the product in the product list
     */
    function getProductAtIndex(uint256 productIndex) public view returns (Product) {
        <span class="missing-if-branch" title="if path not taken" >I</span>if (productIndex &lt; 0 || productIndex &gt;= s_productIndex) {
            revert ProductFactory__ProductNotValid();
        }
        return products[productIndex];
    }
&nbsp;
    /**
     *@dev deletes the Product at productAddress(basically the NFT at productAddress) fromt the list products.
            Method used is fetch the index of productAddress in products list and swap it with last product in the list
            and delete the last.
            (This method is used to avoid shifting of the preceding products to previous indices)
     *@param productAddress the address of the product NFT deployed by a seller
     */
    function deleteProduct(address productAddress)
        external
        haveDeleteAccess(address(msg.sender), productAddress)
        isProductAvailable(productAddress)
    {
        uint256 productIndex = s_addressToProductIndex[productAddress];
        uint256 lastIndex = s_productIndex - 1;
        Product lastProduct = products[lastIndex];
        products[productIndex] = lastProduct;
        s_addressToProductIndex[address(lastProduct)] = productIndex;
        s_isProductAvailable[address(lastProduct)] = false;
        delete products[lastIndex];
        s_productIndex--;
        emit ProductDeleted(address(lastProduct), block.timestamp);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Jul 28 2022 01:19:00 GMT+0530 (India Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
